<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>Rise - Sourdough Calculator | Perfect Bread Recipes</title>
    <meta name="title" content="Rise - Sourdough Calculator | Perfect Bread Recipes">
    <meta name="description" content="Sourdough bread calculator with baker's percentages. Calculate perfect ingredient ratios for total batch or per-unit baking. Includes levain hydration, flour mixing, and inclusions. Free online tool for home bakers.">
    <meta name="keywords" content="sourdough calculator, bread calculator, baker's percentages, sourdough recipe, bread recipe calculator, levain calculator, hydration calculator, flour calculator, bread making tool, sourdough bread, artisan bread, bread baking">
    <meta name="author" content="Rise Sourdough Calculator">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://rise-sourdough.com/">
    <meta property="og:title" content="Rise - Sourdough Calculator | Perfect Bread Recipes">
    <meta property="og:description" content="Sourdough bread calculator with baker's percentages. Calculate perfect ingredient ratios for total batch or per-unit baking. Free online tool for home bakers.">
    <meta property="og:image" content="https://rise-sourdough.com/og-image.jpg">
    <meta property="og:site_name" content="Rise Sourdough Calculator">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://rise-sourdough.com/">
    <meta property="twitter:title" content="Rise - Sourdough Calculator | Perfect Bread Recipes">
    <meta property="twitter:description" content="Sourdough bread calculator with baker's percentages. Calculate perfect ingredient ratios for total batch or per-unit baking. Free online tool for home bakers.">
    <meta property="twitter:image" content="https://rise-sourdough.com/twitter-image.jpg">
    <meta property="twitter:creator" content="@rise_sourdough">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="theme-color" content="#ffffff">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://rise-sourdough.com/">
    
    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="dns-prefetch" href="https://cdn.tailwindcss.com">
    
    <!-- PWA Manifest Link -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png">
    
    <!-- Icons for PWA -->
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#4a2c0a">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Rise - Sourdough Calculator",
        "description": "Sourdough bread calculator with baker's percentages. Calculate perfect ingredient ratios for total batch or per-unit baking.",
        "url": "https://rise-sourdough.com/",
        "applicationCategory": "FoodApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "author": {
            "@type": "Organization",
            "name": "Rise Sourdough Calculator"
        },
        "featureList": [
            "Baker's percentage calculations",
            "Total batch weight calculations",
            "Per-unit weight calculations",
            "Levain hydration calculator",
            "Flour mixing ratios",
            "Inclusions weight calculator",
            "Real-time validation",
            "Professional bread recipe tool"
        ],
        "screenshot": "https://rise-sourdough.com/screenshot.jpg",
        "softwareVersion": "1.0",
        "datePublished": "2024-01-01",
        "dateModified": "2024-01-01",
        "inLanguage": "en-US",
        "isAccessibleForFree": true,
        "browserRequirements": "Requires JavaScript. Requires HTML5.",
        "softwareHelp": "https://rise-sourdough.com/help"
    }
    </script>
    
    <!-- External Resources -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .container {
            max-width: 420px;
        }
        input[type="number"] {
            background-color: #f9fafb;
        }
        input[readonly] {
            background-color: #f3f4f6;
            color: #6b7280;
            cursor: not-allowed;
            border-color: #d1d5db;
        }
        
        /* Validation styles */
        .input-error {
            border-color: #ef4444 !important;
            background-color: #fef2f2 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }
        
        .input-success {
            border-color: #10b981 !important;
            background-color: #f0fdf4 !important;
        }
        
        .error-message {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }
        
        .error-message.show {
            display: block;
        }
        
        .validation-summary {
            background-color: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            display: none;
        }
        
        .validation-summary.show {
            display: block;
        }
        
        .validation-summary h4 {
            color: #dc2626;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .validation-summary ul {
            list-style-type: disc;
            margin-left: 1rem;
            color: #dc2626;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <main class="container mx-auto p-6 bg-white rounded-2xl shadow-xl" role="main" aria-label="Sourdough Calculator">
        <!-- Header Section -->
        <header class="text-center mb-6">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">Rise</h1>
            <h2 class="text-2xl font-semibold text-gray-700 mb-3">Sourdough Calculator</h2>
            <p class="text-gray-500 mt-2">Calculate ingredient weights by total batch weight or per-unit weight and quantity. Perfect for home bakers.</p>
        </header>

        <!-- Calculation Mode Toggle -->
        <section class="mb-6" aria-label="Calculation Mode Selection">
            <h2 class="sr-only">Choose Calculation Mode</h2>
            <div class="flex items-center justify-center space-x-4">
                <span class="text-sm font-medium text-gray-700">Total Batch</span>
                <label class="relative inline-flex items-center cursor-pointer" for="calculation-mode-toggle">
                    <input type="checkbox" id="calculation-mode-toggle" class="sr-only peer" aria-describedby="mode-description">
                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-indigo-600"></div>
                    <span class="ml-3 text-sm font-medium text-gray-700">Per Unit</span>
                </label>
            </div>
            <p id="mode-description" class="text-xs text-gray-500 text-center mt-2">Toggle between calculating for total batch weight or individual unit quantities</p>
        </section>

        <!-- Validation Summary -->
        <div id="validation-summary" class="validation-summary">
            <h4>Please fix the following issues:</h4>
            <ul id="validation-errors-list"></ul>
        </div>

        <!-- Input Section -->
        <form class="space-y-4" role="form" aria-label="Sourdough Recipe Calculator">
            <!-- Total Weight Mode Inputs -->
            <div id="total-weight-mode" class="space-y-4">
                <!-- Total Dough Weight Input -->
                <div>
                    <label for="total-weight" class="block text-sm font-medium text-gray-700">Total Dough Weight (including inclusions) (g)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="total-weight" name="total-weight" value="750" min="50" max="50000" class="block w-full rounded-md border-gray-300 py-2 pl-4 pr-12 focus:border-indigo-500 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">g</span>
                        </div>
                    </div>
                    <div id="total-weight-error" class="error-message"></div>
                </div>

                <!-- Inclusions Weight Input -->
                <div>
                    <label for="inclusions-weight" class="block text-sm font-medium text-gray-700">Inclusions (g)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="inclusions-weight" name="inclusions-weight" value="0" min="0" max="20000" class="block w-full rounded-md border-gray-300 py-2 pl-4 pr-12 focus:border-indigo-500 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">g</span>
                        </div>
                    </div>
                    <div id="inclusions-weight-error" class="error-message"></div>
                </div>
            </div>

            <!-- Per Unit Mode Inputs -->
            <div id="single-loaf-mode" class="space-y-4 hidden">
                <!-- Unit Weight Input -->
                <div>
                    <label for="single-loaf-weight" class="block text-sm font-medium text-gray-700">Unit Weight (g)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="single-loaf-weight" name="single-loaf-weight" value="750" min="50" max="2000" class="block w-full rounded-md border-gray-300 py-2 pl-4 pr-12 focus:border-indigo-500 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">g</span>
                        </div>
                    </div>
                    <div id="single-loaf-weight-error" class="error-message"></div>
                </div>

                <!-- Quantity Input -->
                <div>
                    <label for="number-of-loaves" class="block text-sm font-medium text-gray-700">Quantity</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="number-of-loaves" name="number-of-loaves" value="1" min="1" max="100" class="block w-full rounded-md border-gray-300 py-2 pl-4 pr-12 focus:border-indigo-500 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">units</span>
                        </div>
                    </div>
                    <div id="number-of-loaves-error" class="error-message"></div>
                </div>

                <!-- Inclusions Weight Input (shared) -->
                <div>
                    <label for="inclusions-weight-single" class="block text-sm font-medium text-gray-700">Inclusions per Unit (g)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="inclusions-weight-single" name="inclusions-weight-single" value="0" min="0" max="500" class="block w-full rounded-md border-gray-300 py-2 pl-4 pr-12 focus:border-indigo-500 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">g</span>
                        </div>
                    </div>
                    <div id="inclusions-weight-single-error" class="error-message"></div>
                </div>
            </div>

            <!-- Baker's Percentages Section -->
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="water-percent" class="block text-sm font-medium text-gray-700">Water (%)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="water-percent" name="water-percent" value="70" min="50" max="120" step="0.1" class="block w-full rounded-md border-gray-300 py-2 pl-4 pr-12 focus:border-indigo-500 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">%</span>
                        </div>
                    </div>
                    <div id="water-percent-error" class="error-message"></div>
                </div>
                <div>
                    <label for="salt-percent" class="block text-sm font-medium text-gray-700">Salt (%)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="salt-percent" name="salt-percent" value="2" min="1" max="3" step="0.1" class="block w-full rounded-md border-gray-300 py-2 pl-4 pr-12 focus:border-indigo-500 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">%</span>
                        </div>
                    </div>
                    <div id="salt-percent-error" class="error-message"></div>
                </div>
                <div>
                    <label for="levain-percent" class="block text-sm font-medium text-gray-700">Levain (%)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="levain-percent" name="levain-percent" value="20" min="5" max="50" step="0.1" class="block w-full rounded-md border-gray-300 py-2 pl-4 pr-12 focus:border-indigo-500 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">%</span>
                        </div>
                    </div>
                    <div id="levain-percent-error" class="error-message"></div>
                </div>
                <div>
                    <label for="levain-hydration-percent" class="block text-sm font-medium text-gray-700">Levain Hydration (%)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="levain-hydration-percent" name="levain-hydration-percent" value="100" min="50" max="200" step="0.1" class="block w-full rounded-md border-gray-300 py-2 pl-4 pr-12 focus:border-indigo-500 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">%</span>
                        </div>
                    </div>
                    <div id="levain-hydration-percent-error" class="error-message"></div>
                </div>
            </div>

            <!-- Flour Mix Percentages Section -->
            <hr class="border-gray-300 mt-4 mb-2">
            <section aria-label="Flour Mix Configuration">
                <h3 class="text-lg font-bold text-gray-800">Flour Mix</h3>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="white-flour-percent" class="block text-sm font-medium text-gray-700">White Flour (%)</label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="white-flour-percent" name="white-flour-percent" value="100" min="0" max="100" step="0.1" class="block w-full rounded-md border-gray-300 py-2 pl-4 pr-12 focus:border-indigo-500 focus:ring-indigo-500 transition duration-150 ease-in-out">
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">%</span>
                        </div>
                    </div>
                    <div id="white-flour-percent-error" class="error-message"></div>
                </div>
                <div>
                    <label for="other-flours-percent" class="block text-sm font-medium text-gray-500">Other Flours (%) <span class="text-xs text-gray-400">(calculated)</span></label>
                    <div class="mt-1 relative rounded-md shadow-sm">
                        <input type="number" id="other-flours-percent" name="other-flours-percent" value="0" class="block w-full rounded-md border-gray-300 py-2 pl-4 pr-12 focus:border-indigo-500 focus:ring-indigo-500 transition duration-150 ease-in-out" readonly>
                        <div class="absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none">
                            <span class="text-gray-500 sm:text-sm">%</span>
                        </div>
                    </div>
                </div>
            </div>
            </section>
        </form>

        <!-- Results Section -->
        <section id="results" class="mt-6 p-6 bg-gray-50 rounded-lg hidden" aria-label="Calculated Recipe Results">
            <h2 class="text-lg font-bold text-gray-900 mb-4">Ingredients</h2>
            <ul class="space-y-2">
                <li class="flex justify-between items-center text-gray-900">
                    <span>Main Flour</span>
                    <span id="main-flour-result" class="font-semibold text-gray-900"></span>
                </li>
                <li class="flex justify-between items-center text-gray-800">
                    <span class="ml-4">- White Flour</span>
                    <span id="white-flour-result" class="font-semibold text-gray-900"></span>
                </li>
                <li class="flex justify-between items-center text-gray-800">
                    <span class="ml-4">- Other Flours</span>
                    <span id="other-flours-result" class="font-semibold text-gray-900"></span>
                </li>
                <li class="flex justify-between items-center text-gray-900">
                    <span>Main Water</span>
                    <span id="main-water-result" class="font-semibold text-gray-900"></span>
                </li>
                <li class="flex justify-between items-center text-gray-900">
                    <span>Salt</span>
                    <span id="salt-result" class="font-semibold text-gray-900"></span>
                </li>
                <li class="flex justify-between items-center text-gray-900">
                    <span>Levain</span>
                    <span id="levain-result" class="font-semibold text-gray-900"></span>
                </li>
                <li class="flex justify-between items-center text-gray-900">
                    <span>Inclusions</span>
                    <span id="inclusions-result" class="font-semibold text-gray-900"></span>
                </li>
            </ul>
            
            <hr class="my-4 border-gray-300">
            <h3 class="text-md font-bold text-gray-900 mb-2">Levain Breakdown</h3>
            <ul class="space-y-2">
                <li class="flex justify-between items-center text-gray-800">
                    <span>Levain Flour</span>
                    <span id="levain-flour-result" class="font-semibold text-gray-900"></span>
                </li>
                <li class="flex justify-between items-center text-gray-800">
                    <span>Levain Water</span>
                    <span id="levain-water-result" class="font-semibold text-gray-900"></span>
                </li>
            </ul>
        </section>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Get all the necessary DOM elements
            const calculationModeToggle = document.getElementById('calculation-mode-toggle');
            const totalWeightMode = document.getElementById('total-weight-mode');
            const singleLoafMode = document.getElementById('single-loaf-mode');
            
            const totalWeightInput = document.getElementById('total-weight');
            const inclusionsWeightInput = document.getElementById('inclusions-weight');
            const singleLoafWeightInput = document.getElementById('single-loaf-weight');
            const numberOfLoavesInput = document.getElementById('number-of-loaves');
            const inclusionsWeightSingleInput = document.getElementById('inclusions-weight-single');
            
            const waterPercentInput = document.getElementById('water-percent');
            const saltPercentInput = document.getElementById('salt-percent');
            const levainPercentInput = document.getElementById('levain-percent');
            const levainHydrationPercentInput = document.getElementById('levain-hydration-percent');
            const whiteFlourPercentInput = document.getElementById('white-flour-percent');
            const otherFloursPercentInput = document.getElementById('other-flours-percent');
            const resultsDiv = document.getElementById('results');
            
            const mainFlourResultSpan = document.getElementById('main-flour-result');
            const mainWaterResultSpan = document.getElementById('main-water-result');
            const saltResultSpan = document.getElementById('salt-result');
            const levainResultSpan = document.getElementById('levain-result');
            const inclusionsResultSpan = document.getElementById('inclusions-result');
            const whiteFlourResultSpan = document.getElementById('white-flour-result');
            const otherFloursResultSpan = document.getElementById('other-flours-result');
            
            const levainFlourResultSpan = document.getElementById('levain-flour-result');
            const levainWaterResultSpan = document.getElementById('levain-water-result');

            // Toggle between calculation modes
            function toggleCalculationMode() {
                const isSingleLoafMode = calculationModeToggle.checked;
                
                if (isSingleLoafMode) {
                    totalWeightMode.classList.add('hidden');
                    singleLoafMode.classList.remove('hidden');
                } else {
                    totalWeightMode.classList.remove('hidden');
                    singleLoafMode.classList.add('hidden');
                }
                
                // Recalculate when switching modes
                calculateSourdough();
            }

            // Add event listener for toggle
            calculationModeToggle.addEventListener('change', toggleCalculationMode);

            // Validation rules and messages
            const validationRules = {
                'total-weight': {
                    min: 50,
                    max: 50000,
                    message: 'Total dough weight must be between 50g and 50000g'
                },
                'inclusions-weight': {
                    min: 0,
                    max: 20000,
                    message: 'Inclusions weight must be between 0g and 20000g'
                },
                'single-loaf-weight': {
                    min: 50,
                    max: 2000,
                    message: 'Unit weight must be between 50g and 2000g'
                },
                'number-of-loaves': {
                    min: 1,
                    max: 100,
                    message: 'Quantity must be between 1 and 100 units'
                },
                'inclusions-weight-single': {
                    min: 0,
                    max: 500,
                    message: 'Inclusions per unit must be between 0g and 500g'
                },
                'water-percent': {
                    min: 50,
                    max: 120,
                    message: 'Water percentage must be between 50% and 120%'
                },
                'salt-percent': {
                    min: 1,
                    max: 3,
                    message: 'Salt percentage must be between 1% and 3%'
                },
                'levain-percent': {
                    min: 5,
                    max: 50,
                    message: 'Levain percentage must be between 5% and 50%'
                },
                'levain-hydration-percent': {
                    min: 50,
                    max: 200,
                    message: 'Levain hydration must be between 50% and 200%'
                },
                'white-flour-percent': {
                    min: 0,
                    max: 100,
                    message: 'White flour percentage must be between 0% and 100%'
                }
            };

            // Validation state
            let validationErrors = [];
            let isValid = true;

            // Function to validate a single input
            function validateInput(inputId, value) {
                const rule = validationRules[inputId];
                if (!rule) return true;

                const numValue = parseFloat(value);
                const errorElement = document.getElementById(inputId + '-error');
                const inputElement = document.getElementById(inputId);

                // Clear previous error state
                if (errorElement) {
                    errorElement.classList.remove('show');
                    errorElement.textContent = '';
                }
                if (inputElement) {
                    inputElement.classList.remove('input-error', 'input-success');
                }

                // Check if value is valid number
                if (isNaN(numValue)) {
                    if (errorElement) {
                        errorElement.textContent = 'Please enter a valid number';
                        errorElement.classList.add('show');
                    }
                    if (inputElement) {
                        inputElement.classList.add('input-error');
                    }
                    return false;
                }

                // Check range
                if (numValue < rule.min || numValue > rule.max) {
                    if (errorElement) {
                        errorElement.textContent = rule.message;
                        errorElement.classList.add('show');
                    }
                    if (inputElement) {
                        inputElement.classList.add('input-error');
                    }
                    return false;
                }

                // Success state
                if (inputElement) {
                    inputElement.classList.add('input-success');
                }
                return true;
            }

            // Function to validate all inputs
            function validateAllInputs() {
                validationErrors = [];
                isValid = true;

                // Validate based on current mode
                const isSingleLoafMode = calculationModeToggle.checked;
                
                if (isSingleLoafMode) {
                    isValid &= validateInput('single-loaf-weight', singleLoafWeightInput.value);
                    isValid &= validateInput('number-of-loaves', numberOfLoavesInput.value);
                    isValid &= validateInput('inclusions-weight-single', inclusionsWeightSingleInput.value);
                } else {
                    isValid &= validateInput('total-weight', totalWeightInput.value);
                    isValid &= validateInput('inclusions-weight', inclusionsWeightInput.value);
                }

                // Validate percentages
                isValid &= validateInput('water-percent', waterPercentInput.value);
                isValid &= validateInput('salt-percent', saltPercentInput.value);
                isValid &= validateInput('levain-percent', levainPercentInput.value);
                isValid &= validateInput('levain-hydration-percent', levainHydrationPercentInput.value);
                isValid &= validateInput('white-flour-percent', whiteFlourPercentInput.value);

                // Additional business logic validation
                const totalWeight = isSingleLoafMode ? 
                    (parseFloat(singleLoafWeightInput.value) || 0) * (parseFloat(numberOfLoavesInput.value) || 1) :
                    parseFloat(totalWeightInput.value) || 0;
                const inclusionsWeight = isSingleLoafMode ?
                    (parseFloat(inclusionsWeightSingleInput.value) || 0) * (parseFloat(numberOfLoavesInput.value) || 1) :
                    parseFloat(inclusionsWeightInput.value) || 0;

                if (totalWeight <= inclusionsWeight) {
                    const errorId = isSingleLoafMode ? 'inclusions-weight-single' : 'inclusions-weight';
                    const errorElement = document.getElementById(errorId + '-error');
                    const inputElement = document.getElementById(errorId);
                    
                    if (errorElement) {
                        errorElement.textContent = 'Inclusions cannot exceed total dough weight';
                        errorElement.classList.add('show');
                    }
                    if (inputElement) {
                        inputElement.classList.add('input-error');
                    }
                    isValid = false;
                }

                // Show/hide validation summary
                const validationSummary = document.getElementById('validation-summary');
                const validationErrorsList = document.getElementById('validation-errors-list');
                
                if (!isValid) {
                    validationSummary.classList.add('show');
                    validationErrorsList.innerHTML = '';
                    
                    // Collect all error messages
                    const allErrorElements = document.querySelectorAll('.error-message.show');
                    allErrorElements.forEach(errorElement => {
                        if (errorElement.textContent) {
                            const li = document.createElement('li');
                            li.textContent = errorElement.textContent;
                            validationErrorsList.appendChild(li);
                        }
                    });
                } else {
                    validationSummary.classList.remove('show');
                }

                return isValid;
            }

            // Function to perform the calculations
            function calculateSourdough() {
                // Validate all inputs first
                if (!validateAllInputs()) {
                    resultsDiv.classList.add('hidden');
                    return;
                }

                const isSingleLoafMode = calculationModeToggle.checked;
                
                // Get the input values and convert them to numbers
                let totalWeight, inclusionsWeight;
                
                if (isSingleLoafMode) {
                    const singleLoafWeight = parseFloat(singleLoafWeightInput.value);
                    const numberOfLoaves = parseFloat(numberOfLoavesInput.value) || 1;
                    inclusionsWeight = parseFloat(inclusionsWeightSingleInput.value) || 0;
                    totalWeight = (singleLoafWeight - inclusionsWeight) * numberOfLoaves + (inclusionsWeight * numberOfLoaves);
                } else {
                    totalWeight = parseFloat(totalWeightInput.value);
                    inclusionsWeight = parseFloat(inclusionsWeightInput.value) || 0;
                }
                
                const waterPercent = parseFloat(waterPercentInput.value);
                const saltPercent = parseFloat(saltPercentInput.value);
                const levainPercent = parseFloat(levainPercentInput.value);
                const levainHydrationPercent = parseFloat(levainHydrationPercentInput.value);
                const whiteFlourPercent = parseFloat(whiteFlourPercentInput.value);

                // Update the other flour percentage
                otherFloursPercentInput.value = 100 - whiteFlourPercent;

                // Calculate the dough weight without inclusions
                const doughWeight = totalWeight - inclusionsWeight;

                // Convert percentages to decimals
                const waterRatio = waterPercent / 100;
                const saltRatio = saltPercent / 100;
                const levainRatio = levainPercent / 100;
                const levainHydrationRatio = levainHydrationPercent / 100;
                
                // --- CORRECTED CALCULATION LOGIC ---
                // The total dough weight (without inclusions) is the sum of total flour, total water, and salt.
                // All percentages are based on the total flour weight (F_total).
                // DoughWeight = F_total + (F_total * waterRatio) + (F_total * saltRatio)
                // DoughWeight = F_total * (1 + waterRatio + saltRatio)
                
                const doughRatio = 1 + waterRatio + saltRatio;
                const totalFlourWeight = doughWeight / doughRatio;

                // Now calculate the weight of all ingredients
                const totalWaterWeight = totalFlourWeight * waterRatio;
                const totalSaltWeight = totalFlourWeight * saltRatio;
                const totalLevainWeight = totalFlourWeight * levainRatio;

                // Breakdown the levain into its flour and water components
                const levainFlourWeight = totalLevainWeight / (1 + levainHydrationRatio);
                const levainWaterWeight = totalLevainWeight - levainFlourWeight;

                // Calculate the main dough flour and water by subtracting levain components
                const mainFlourWeight = totalFlourWeight - levainFlourWeight;
                const mainWaterWeight = totalWaterWeight - levainWaterWeight;

                // Calculate the breakdown of the MAIN flour
                const whiteFlourWeight = mainFlourWeight * (whiteFlourPercent / 100);
                const otherFloursWeight = mainFlourWeight - whiteFlourWeight;
                
                // Display the results with specified rounding
                mainFlourResultSpan.textContent = `${mainFlourWeight.toFixed(0)} g`;
                mainWaterResultSpan.textContent = `${mainWaterWeight.toFixed(0)} g`;
                saltResultSpan.textContent = `${totalSaltWeight.toFixed(1)} g`;
                levainResultSpan.textContent = `${totalLevainWeight.toFixed(0)} g`;
                inclusionsResultSpan.textContent = `${inclusionsWeight.toFixed(0)} g`;
                
                whiteFlourResultSpan.textContent = `${whiteFlourWeight.toFixed(0)} g`;
                otherFloursResultSpan.textContent = `${otherFloursWeight.toFixed(0)} g`;
                
                // Display the levain breakdown
                levainFlourResultSpan.textContent = `${levainFlourWeight.toFixed(0)} g`;
                levainWaterResultSpan.textContent = `${levainWaterWeight.toFixed(0)} g`;

                // Show the results section
                resultsDiv.classList.remove('hidden');
            }

            // Add event listeners for input changes with real-time validation
            [totalWeightInput, inclusionsWeightInput, singleLoafWeightInput, numberOfLoavesInput, inclusionsWeightSingleInput, waterPercentInput, saltPercentInput, levainPercentInput, levainHydrationPercentInput, whiteFlourPercentInput].forEach(input => {
                input.addEventListener('input', (e) => {
                    // Real-time validation for individual input
                    const inputId = e.target.id;
                    validateInput(inputId, e.target.value);
                    
                    // Then run full calculation
                    calculateSourdough();
                });
                
                // Also validate on blur for better UX
                input.addEventListener('blur', (e) => {
                    const inputId = e.target.id;
                    validateInput(inputId, e.target.value);
                });
            });

            // Initial calculation on page load
            calculateSourdough();
        });

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js').then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
            });
        }
    </script>

</body>
</html>

